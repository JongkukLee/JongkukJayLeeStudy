---
layout: default
---
# BCI433
---


## LAB10 ##

PF-SRC MAKE FILTER

WRKOBJPDM (F4)
- DT433A11
- PGM


SQLCA
SQLCODE
 = 0 SUCCESSFUL EXEC OF SQL
 > 0 SUCCESS EXEC WITH AS WARNING
 = 100 ROW NOT FOUND (NO MORE ROW)
 < 0 ERROR OCCURED (UNSUCCESS EXEC)



SQLWN0 - SET TO 'W' IF AT LEAST ONE OTHER INDICATOR CONTAINS A 'W'. IT IS BLACK IF ALL THE OTHER INDICATORS ARE BLANK

SQLWN1 - TRUNCATION 

SQLWN2 - CONTAINS 'W' IF NULL VALUES WERE ELIMINATED 

SQLWN3 - 

SQLWNA - 


-----------------------
SLTCUSTCITY
 - TORONTO
NEW DISCOUNT
 - 12

STATIC EMBEDED SQL STATEMMENT: FIGURE OUT WHEN IT IS COMPILED IN PRECOMPILE STAGE

THE STRUCTURE DOES NOT CHANGE INT THE PROGRAM. THE PRECOMIILER WILL BUILD THE APPROPRIATE HIGH LEVEL LANGUAGE STATEMENTS. ONLY VALUES SUPPLIED BY HOST VARIABLES USED IN THE STATEMENT MAY CHANGE.
```
EXEC SQL
	UPDATE CUSTOMER
	SET DISCOUNT = :NEWDISC
	WHERE SHIPCITY = :SLTCUSTCITY;

	SELECT	CUSTID, 
		NAME,
		SHIPCITY,
		DISCOUNT

	INTO	:CSCUSTID, 
		:CSNAME,
		:CSSHIPCITY :CSCITYNULL -- INDICATE VALIABLES,
		:CSDICOUNT :CSDISCNULL --,
	FROM	CUSTOMER
	WHERE CUSTID = :SLTCUSTID;
```

IF MULTIPLE ROWS ARE RETRIVED, THEN THIS STATEMENT FAILS
IF ONE ROW IS RETRIVED THIS STATEMENT SUCCEEDS

	**:CSCITYNULL AND :CSDISCNULL ARE INDICATOR VARIABLES** IF THEY ARE SET TO -1 THAN THE VALUE WAS NULL
```
EXEC SQL
	SELECT	AVG(DISCOUNT) 
	INTO	:AVGDISC :AVGDISCNULL
	FORM	CUSTOMER

	INSERT INTO CUSTOMER
			(CUSTID,
			NAME,
			SHIPCITY,
			DISCOUNT)
		VALUES (:CSCUSTID,
			:CSNAME,
			:CSHIPCITY :CSCITYNULL,
			:CSDISCOUNT :CSDISCNULL);

-- WHEN THE INDICATOR VARIABLES IS -1 THE CULUMN IS SET TO NULL
	D CSCITYNULL	4B	0

	-- B: BINARY, 0: NUMERIC
```
```
EXEC SQL
	DELETE FORM CUSTOMER
	WHERE CUSTID = :SLCCUSTID;
```





     F**************************************************************************
     F*  CUSTOMER17 READ BY NATIVE LANGUAGE (ILE RPG)
     F*  CONTACTF17 ROW RETRIEVED WITH EMBEDDED SQL
     F*  DETAIL REPORT LINE INCLUDES INFORMATION FROM CUSTOMER17 AND CONTACTF17
     F*  SUMMARRY REPORT INFORMATION RETRIEVED WITH EMBEDDED SQL STATEMENTS
     F**************************************************************************

     FCUSTOMER17IF   E             DISK    RENAME(CUSTOMER17:CUSTOMERRF)
     FQPRINT    O    F  132        PRINTER OFLIND(*INOF) FORMOFL(30) FORMLEN(66)

     D*  H O S T   V A R I A B L E S
     D* ??
     D CONTACTF17  E   DS
     D ContactTotal    S              5  0
     D CustomerTotal   S              5  0
     D UnknownTotal    S              5  0
     D OldestDate      S               D
     D MostRecentDate  S               D
     D User            S             10
     D Server          S             10
     D TimeStamp       S               Z
     D DateIn          S              5  0

     D*  I N D I C A T O R   V A R I A B L E S
     D* ??
     D* ??



     D Dummy           S              1  0
     D Flag            S              7
     D NextCallDate    S               D
     C/EJECT
     C**************************************************************************
     C*                        ***   M A I N   R O U T I N E   ***
     C**************************************************************************
      /FREE
                EXSR SummaryInfo;
                EXCEPT HEADINGS;
                READ CUSTOMER17;
                DOW NOT %EOF;
                    EXSR SQLSelect;
                    IF *INOF = *ON;
                       EXCEPT HEADINGS;
                       *INOF = *OFF;
                    ENDIF;
                    EXCEPT DETAIL;
                   READ CUSTOMER17;
                ENDDO;
                EXCEPT TOTALS;
                *INLR = *ON;
                RETURN;
        //*************************************************************************
        //   S Q L S E L E C T   S U B R O U T I N E
   //   //********************************************************************
   //                  BEGSR    SQLSelect ;
   //    // A row from the contacts table that has the same customer number as the
   //    // read from the CUSTOMER17 file is retrieved to find out the last date ca
   //    // phone number, comments and the salesperson number.
   //
   //    //  The call back interval is added to the last date called to determine th
   //    //  next date to call.  Since null values may be stored in the last date ca
   //    // indicator variables are used.









































                         ENDSR ;
        //**********************************************************************
        // S U M M A R Y I N F O   S U B R O U T I N E
        //**********************************************************************
                         BEGSR  SummaryInfo;
        //  D E T E R M I N E   T O T A L S   F O R   CONTACTF17 & CUSTOMER17
















        // D E T E R M I N E   N U M B E R   O F   U N K N O W N   L A S T   D A









        //  D E T E R M I N E   O L D E S T   &  M O S T   R E C E N T  L A S T





















       // D E T E R M I N E   T H E   U S E R   S E R V E R   &   T I M E S T A






      /END-FREE
     OQPRINT    E            HEADINGS       2 02
     O                                            5 'USER:'
     O                       USER                16
     O                                           28 'TIMESTAMP:'
     O                       TIMESTAMP           55
     O                                           64 'SERVER:'
     O                       SERVER              75
     O                                           87 'PAGE:'
     O                       PAGE                90
     O          E            HEADINGS       2
     O                                           54 'Phone Log Report'
     O                       UDATE         Y     89
     O          E            HEADINGS       1
     O                                            5 'Sales'
     O                                           15 'Customer'
     O                                           31 'Customer Name'
     O                                           59 'Telephone'
     O                                           75 'Last Call'
     O                                           88 'Oldest Call'
     O                                          101 'Next Call'
     O          E            HEADINGS       2
     O                                            3 'ID'
     O                                           13 'Number'
     O                                           73 'Date'
     O                                           85 'Date'
     O                                           98 'Date'
     O          E            DETAIL         1
     O                       CSTSLN               3
     O                       CSTNUM              13
     O                       CSTNAM              48
     O                       CSTPHN              64
     O                       PHNLDC              75
     O                       FLAG                86
     O                       NextCallDate       101
     O          E            TOTALS      2  2
     O                                           32 'Summary Information'
     O          E            TOTALS         1
     O                                           26 'CONTACTF17 Total Records:'
     O                       ContactTotal  1     34
     O          E            TOTALS         1
     O                                           26 'CUSTOMER17 Total Records:'
     O                       CustomerTotal 1     34
     O          E            TOTALS      1  1
     O                                           27 'Oldest Last Callback Date:'
     O                       OldestDate          42
     O          E            TOTALS         1
     O                                           27 'Most Recent Callback Date:'
     O                       MostRecentDate      42
     O          E            TOTALS      2  1
     O                                           22 'Total Records with an'
     O                                           47 'Unknown Last Date Called'
     O                                           62 'in CONTACTF17:'
     O                       UnknownTotal        70 


	








	











